"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5930],{5961:(N,O,c)=>{c.d(O,{GW:()=>h,dk:()=>D,oK:()=>d});var d=function(m){return m.Prompt="PROMPT",m.Camera="CAMERA",m.Photos="PHOTOS",m}(d||{}),h=function(m){return m.Rear="REAR",m.Front="FRONT",m}(h||{}),D=function(m){return m.Uri="uri",m.Base64="base64",m.DataUrl="dataUrl",m}(D||{})},2726:(N,O,c)=>{c.d(O,{Sd:()=>E,Uw:()=>w,fo:()=>J,xz:()=>n});var d=c(5861);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var U=function(o){return o.Unimplemented="UNIMPLEMENTED",o.Unavailable="UNAVAILABLE",o}(U||{});class n extends Error{constructor(e,t,a){super(e),this.message=e,this.code=t,this.data=a}}const X=o=>{var e,t,a,u,s;const f=o.CapacitorCustomPlatform||null,l=o.Capacitor||{},A=l.Plugins=l.Plugins||{},p=o.CapacitorPlatforms,S=(null===(e=null==p?void 0:p.currentPlatform)||void 0===e?void 0:e.getPlatform)||(()=>null!==f?f.name:(o=>{var e,t;return null!=o&&o.androidBridge?"android":null!==(t=null===(e=null==o?void 0:o.webkit)||void 0===e?void 0:e.messageHandlers)&&void 0!==t&&t.bridge?"ios":"web"})(o)),ue=(null===(t=null==p?void 0:p.currentPlatform)||void 0===t?void 0:t.isNativePlatform)||(()=>"web"!==S()),fe=(null===(a=null==p?void 0:p.currentPlatform)||void 0===a?void 0:a.isPluginAvailable)||(P=>{const y=te.get(P);return!!(null!=y&&y.platforms.has(S())||ae(P))}),ae=(null===(u=null==p?void 0:p.currentPlatform)||void 0===u?void 0:u.getPluginHeader)||(P=>{var y;return null===(y=l.PluginHeaders)||void 0===y?void 0:y.find(H=>H.name===P)}),te=new Map,ve=(null===(s=null==p?void 0:p.currentPlatform)||void 0===s?void 0:s.registerPlugin)||((P,y={})=>{const H=te.get(P);if(H)return console.warn(`Capacitor plugin "${P}" already registered. Cannot register plugins twice.`),H.proxy;const R=S(),G=ae(P);let F;const be=function(){var C=(0,d.Z)(function*(){return!F&&R in y?F=F="function"==typeof y[R]?yield y[R]():y[R]:null!==f&&!F&&"web"in y&&(F=F="function"==typeof y.web?yield y.web():y.web),F});return function(){return C.apply(this,arguments)}}(),ne=C=>{let $;const T=(...k)=>{const x=be().then(L=>{const W=((C,$)=>{var T,k;if(!G){if(C)return null===(k=C[$])||void 0===k?void 0:k.bind(C);throw new n(`"${P}" plugin is not implemented on ${R}`,U.Unimplemented)}{const x=null==G?void 0:G.methods.find(L=>$===L.name);if(x)return"promise"===x.rtype?L=>l.nativePromise(P,$.toString(),L):(L,W)=>l.nativeCallback(P,$.toString(),L,W);if(C)return null===(T=C[$])||void 0===T?void 0:T.bind(C)}})(L,C);if(W){const Y=W(...k);return $=null==Y?void 0:Y.remove,Y}throw new n(`"${P}.${C}()" is not implemented on ${R}`,U.Unimplemented)});return"addListener"===C&&(x.remove=(0,d.Z)(function*(){return $()})),x};return T.toString=()=>`${C.toString()}() { [capacitor code] }`,Object.defineProperty(T,"name",{value:C,writable:!1,configurable:!1}),T},le=ne("addListener"),de=ne("removeListener"),ye=(C,$)=>{const T=le({eventName:C},$),k=function(){var L=(0,d.Z)(function*(){const W=yield T;de({eventName:C,callbackId:W},$)});return function(){return L.apply(this,arguments)}}(),x=new Promise(L=>T.then(()=>L({remove:k})));return x.remove=(0,d.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield k()}),x},re=new Proxy({},{get(C,$){switch($){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return G?ye:le;case"removeListener":return de;default:return ne($)}}});return A[P]=re,te.set(P,{name:P,proxy:re,platforms:new Set([...Object.keys(y),...G?[R]:[]])}),re});return l.convertFileSrc||(l.convertFileSrc=P=>P),l.getPlatform=S,l.handleError=P=>o.console.error(P),l.isNativePlatform=ue,l.isPluginAvailable=fe,l.pluginMethodNoop=(P,y,H)=>Promise.reject(`${H} does not have an implementation of "${y}".`),l.registerPlugin=ve,l.Exception=n,l.DEBUG=!!l.DEBUG,l.isLoggingEnabled=!!l.isLoggingEnabled,l.platform=l.getPlatform(),l.isNative=l.isNativePlatform(),l},j=(o=>o.Capacitor=X(o))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),J=j.registerPlugin;class w{constructor(e){this.listeners={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){var a=this;this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);const s=this.windowListeners[e];s&&!s.registered&&this.addWindowListener(s);const f=function(){var A=(0,d.Z)(function*(){return a.removeListener(e,t)});return function(){return A.apply(this,arguments)}}(),l=Promise.resolve({remove:f});return Object.defineProperty(l,"remove",{value:(A=(0,d.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield f()}),function(){return A.apply(this,arguments)})}),l;var A}removeAllListeners(){var e=this;return(0,d.Z)(function*(){e.listeners={};for(const t in e.windowListeners)e.removeWindowListener(e.windowListeners[t]);e.windowListeners={}})()}notifyListeners(e,t){const a=this.listeners[e];a&&a.forEach(u=>u(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:a=>{this.notifyListeners(t,a)}}}unimplemented(e="not implemented"){return new j.Exception(e,U.Unimplemented)}unavailable(e="not available"){return new j.Exception(e,U.Unavailable)}removeListener(e,t){var a=this;return(0,d.Z)(function*(){const u=a.listeners[e];if(!u)return;const s=u.indexOf(t);a.listeners[e].splice(s,1),a.listeners[e].length||a.removeWindowListener(a.windowListeners[e])})()}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const _=o=>encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),r=o=>o.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class i extends w{getCookies(){return(0,d.Z)(function*(){const e=document.cookie,t={};return e.split(";").forEach(a=>{if(a.length<=0)return;let[u,s]=a.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");u=r(u).trim(),s=r(s).trim(),t[u]=s}),t})()}setCookie(e){return(0,d.Z)(function*(){try{const t=_(e.key),a=_(e.value),u=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),f=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${a||""}${u}; path=${s}; ${f};`}catch(t){return Promise.reject(t)}})()}deleteCookie(e){return(0,d.Z)(function*(){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}})()}clearCookies(){return(0,d.Z)(function*(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}})()}clearAllCookies(){var e=this;return(0,d.Z)(function*(){try{yield e.clearCookies()}catch(t){return Promise.reject(t)}})()}}J("CapacitorCookies",{web:()=>new i});const b=function(){var o=(0,d.Z)(function*(e){return new Promise((t,a)=>{const u=new FileReader;u.onload=()=>{const s=u.result;t(s.indexOf(",")>=0?s.split(",")[1]:s)},u.onerror=s=>a(s),u.readAsDataURL(e)})});return function(t){return o.apply(this,arguments)}}(),E=(o,e={})=>{const t=Object.assign({method:o.method||"GET",headers:o.headers},e),u=((o={})=>{const e=Object.keys(o);return Object.keys(o).map(u=>u.toLocaleLowerCase()).reduce((u,s,f)=>(u[s]=o[e[f]],u),{})})(o.headers)["content-type"]||"";if("string"==typeof o.data)t.body=o.data;else if(u.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[f,l]of Object.entries(o.data||{}))s.set(f,l);t.body=s.toString()}else if(u.includes("multipart/form-data")){const s=new FormData;if(o.data instanceof FormData)o.data.forEach((l,A)=>{s.append(A,l)});else for(const l of Object.keys(o.data))s.append(l,o.data[l]);t.body=s;const f=new Headers(t.headers);f.delete("content-type"),t.headers=f}else(u.includes("application/json")||"object"==typeof o.data)&&(t.body=JSON.stringify(o.data));return t};class q extends w{request(e){return(0,d.Z)(function*(){const t=E(e,e.webFetchExtra),a=((o,e=!0)=>o?Object.entries(o).reduce((a,u)=>{const[s,f]=u;let l,A;return Array.isArray(f)?(A="",f.forEach(p=>{l=e?encodeURIComponent(p):p,A+=`${s}=${l}&`}),A.slice(0,-1)):(l=e?encodeURIComponent(f):f,A=`${s}=${l}`),`${a}&${A}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),u=a?`${e.url}?${a}`:e.url,s=yield fetch(u,t),f=s.headers.get("content-type")||"";let A,p,{responseType:l="text"}=s.ok?e:{};switch(f.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":p=yield s.blob(),A=yield b(p);break;case"json":A=yield s.json();break;default:A=yield s.text()}const z={};return s.headers.forEach((S,ee)=>{z[ee]=S}),{data:A,headers:z,status:s.status,url:s.url}})()}get(e){var t=this;return(0,d.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"GET"}))})()}post(e){var t=this;return(0,d.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"POST"}))})()}put(e){var t=this;return(0,d.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"PUT"}))})()}patch(e){var t=this;return(0,d.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"PATCH"}))})()}delete(e){var t=this;return(0,d.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"DELETE"}))})()}}J("CapacitorHttp",{web:()=>new q})},5346:(N,O,c)=>{c.d(O,{ez:()=>h,tP:()=>d});var d=function(v){return v.Documents="DOCUMENTS",v.Data="DATA",v.Library="LIBRARY",v.Cache="CACHE",v.External="EXTERNAL",v.ExternalStorage="EXTERNAL_STORAGE",v}(d||{}),h=function(v){return v.UTF8="utf8",v.ASCII="ascii",v.UTF16="utf16",v}(h||{})},5930:(N,O,c)=>{c.r(O),c.d(O,{AddImagesPage:()=>ie});var d=c(5861),h=c(1509),D=c(2726),m=c(5346);const v=(0,D.fo)("Filesystem",{web:()=>c.e(4522).then(c.bind(c,4522)).then(w=>new w.FilesystemWeb)});var Q=c(5961);const V=(0,D.fo)("Camera",{web:()=>c.e(6468).then(c.bind(c,6468)).then(w=>new w.CameraWeb)});var U=c(6814),n=c(6689),K=c(6958),X=c(7626),oe=c(1434);function j(w,B){1&w&&(n.TgZ(0,"h3",10),n._uU(1,"\u0627\u0644\u0631\u062c\u0627\u0621 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0635\u0648\u0631\u0629!"),n.qZA())}function J(w,B){if(1&w){const _=n.EpF();n.TgZ(0,"ion-item")(1,"ion-thumbnail",11),n._UZ(2,"ion-img",12),n.qZA(),n.TgZ(3,"ion-label",13),n._uU(4),n.qZA(),n.TgZ(5,"ion-button",14),n.NdJ("click",function(){const g=n.CHM(_).$implicit,b=n.oxw();return n.KtG(b.deleteImage(g))}),n._UZ(6,"ion-icon",15),n.qZA()()}if(2&w){const _=B.$implicit;n.xp6(2),n.Q6J("src",_.data),n.xp6(2),n.hij(" ",_.name," ")}}const M="stored-images";let ie=(()=>{var w;class B{constructor(r,i,g,b,I){var Z,E;this.supabase=i,this.router=g,this.plt=b,this.helper=I,this.modelId=1,this.type="request_status",this.convertBlobToBase64=q=>new Promise((se,o)=>{const e=new FileReader;e.onerror=o,e.onload=()=>{se(e.result)},e.readAsDataURL(q)}),this.pathImage=[],this.modelId=null===(Z=r.snapshot.paramMap)||void 0===Z?void 0:Z.get("id"),this.type=null===(E=r.snapshot.paramMap)||void 0===E?void 0:E.get("type")}ngOnInit(){var r=this;return(0,d.Z)(function*(){yield r.loadFiles()})()}loadFiles(){var r=this;return(0,d.Z)(function*(){r.images=[],yield r.helper.startLoad(),v.readdir({path:`${M}-${r.type}-${r.modelId}`,directory:m.tP.Data}).then(i=>{r.loadFileData(i.files.map(g=>g.name))},function(){var i=(0,d.Z)(function*(g){yield v.mkdir({path:`${M}-${r.type}-${r.modelId}`,directory:m.tP.Data})});return function(g){return i.apply(this,arguments)}}()).then(i=>{r.helper.dismissLoader()})})()}loadFileData(r){var i=this;return(0,d.Z)(function*(){const g=`${M}-${i.type}-${i.modelId}`;for(let b of r){const I=`${g}/${b}`,Z=yield v.readFile({path:I,directory:m.tP.Data});i.images.push({name:b,path:I,data:`data:image/jpeg;base64,${Z.data}`})}})()}selectImage(){var r=this;return(0,d.Z)(function*(){const i=yield V.getPhoto({quality:90,allowEditing:!1,resultType:Q.dk.Uri,source:Q.oK.Photos});i&&(yield r.saveImage(i))})()}saveImage(r){var i=this;return(0,d.Z)(function*(){const g=yield i.readAsBase64(r),b=(new Date).getTime()+".jpeg",I=`${M}-${i.type}-${i.modelId}`;yield v.writeFile({path:`${I}/${b}`,data:g,directory:m.tP.Data}),yield i.loadFiles()})()}readAsBase64(r){var i=this;return(0,d.Z)(function*(){if(i.plt.is("hybrid"))return(yield v.readFile({path:r.path})).data;{const b=yield(yield fetch(r.webPath)).blob();return yield i.convertBlobToBase64(b)}})()}startUpload(r){var i=this;return(0,d.Z)(function*(){const b=yield(yield fetch(r.data)).blob(),I=new FormData;I.append("image",b,r.name),yield i.uploadData(I)})()}uploadData(r){var i=this;return(0,d.Z)(function*(){r.append("request_id",i.modelId),r.append("type",i.type),i.supabase.saveFiles(i.type,i.modelId,r).then(g=>{var b;i.pathImage.push(null===(b=g.data)||void 0===b?void 0:b.path),i.helper.dismissLoader()}).catch(g=>{console.log(g)})})()}deleteImage(r){var i=this;return(0,d.Z)(function*(){yield i.loadFiles()})()}deleteImages(){var r=this;return(0,d.Z)(function*(){yield v.rmdir({directory:m.tP.Data,path:`${M}-${r.type}-${r.modelId}`,recursive:!0}),yield r.loadFiles(),yield r.router.navigate(["/"])})()}uploadAllImage(){var r=this;return(0,d.Z)(function*(){yield r.helper.startLoad();for(let i of r.images){const b=yield(yield fetch(i.data)).blob(),I=new FormData;I.append("image",b,i.name),yield r.supabase.saveFiles(r.type,r.modelId,I).then(Z=>{var E;r.pathImage.push(null===(E=Z.data)||void 0===E?void 0:E.path)}).catch(Z=>{console.error(Z)})}console.log(r.pathImage),yield r.supabase.updateData(r.type,r.modelId,{images:r.pathImage}).then(i=>204===i.status?(r.router.navigate(["/"]),void r.helper.presentToast("\u062a\u0645 \u062a\u0642\u062f\u064a\u0645 \u0627\u0644\u0637\u0644\u0628 \u0628\u0646\u062c\u0627\u062d")):void r.helper.presentAlert("\u062e\u0637\u0627")).catch(i=>{console.log(i),r.helper.presentAlert(`err: ${i}`)}),yield r.helper.dismissLoader()})()}}return(w=B).\u0275fac=function(r){return new(r||w)(n.Y36(K.gz),n.Y36(X.T),n.Y36(K.F0),n.Y36(h.t4),n.Y36(oe.W))},w.\u0275cmp=n.Xpm({type:w,selectors:[["app-add-images"]],standalone:!0,features:[n.jDz],decls:19,vars:3,consts:[[3,"fullscreen"],["class","ion-padding ion-text-center",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"m-ion-toolbar"],["color","m-ion-toolbar"],["fill","clear","expand","full","color","success",3,"click"],["slot","start","name","camera"],["fill","clear","expand","full","color","secondary",3,"click"],["slot","start","name","save"],["fill","clear","expand","full","color","danger",3,"click"],[1,"ion-padding","ion-text-center"],["slot","start"],[3,"src"],[1,"ion-text-wrap"],["slot","end","fill","clear",3,"click"],["slot","icon-only","name","trash"]],template:function(r,i){1&r&&(n.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n._uU(3,"\u0631\u0641\u0639 \u0627\u0644\u0645\u0631\u0641\u0642\u0627\u062a"),n.qZA()()(),n.TgZ(4,"ion-content",0),n.YNc(5,j,2,0,"h3",1),n.TgZ(6,"ion-list"),n.YNc(7,J,7,2,"ion-item",2),n.qZA()(),n.TgZ(8,"ion-footer",3)(9,"ion-toolbar",4)(10,"ion-button",5),n.NdJ("click",function(){return i.selectImage()}),n._UZ(11,"ion-icon",6),n._uU(12," \u0627\u062e\u062a\u0627\u0631 \u0627\u0644\u0635\u0648\u0631\u0629 "),n.qZA(),n.TgZ(13,"ion-button",7),n.NdJ("click",function(){return i.uploadAllImage()}),n._UZ(14,"ion-icon",8),n._uU(15," \u062d\u0641\u0638 \u0627\u0644\u0635\u0648\u0631\u0629 "),n.qZA(),n.TgZ(16,"ion-button",9),n.NdJ("click",function(){return i.deleteImages()}),n._UZ(17,"ion-icon",6),n._uU(18," \u062d\u0641\u0638 \u0645\u0646 \u062f\u0648\u0646 \u0635\u0648\u0631 "),n.qZA()()()),2&r&&(n.xp6(4),n.Q6J("fullscreen",!0),n.xp6(1),n.Q6J("ngIf",0===i.images.length),n.xp6(2),n.Q6J("ngForOf",i.images))},dependencies:[h.Pc,h.YG,h.W2,h.fr,h.Gu,h.gu,h.Xz,h.Ie,h.Q$,h.q_,h.Bs,h.wd,h.sr,U.ez,U.sg,U.O5],styles:[".m-ion-toolbar[_ngcontent-%COMP%]{--background: #383a3e !important;border-radius:1.5%;background:#383a3e!important}"]}),B})()}}]);