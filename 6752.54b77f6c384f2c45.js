"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6752],{5961:(T,y,s)=>{s.d(y,{GW:()=>l,dk:()=>m,oK:()=>u});var u=function(r){return r.Prompt="PROMPT",r.Camera="CAMERA",r.Photos="PHOTOS",r}(u||{}),l=function(r){return r.Rear="REAR",r.Front="FRONT",r}(l||{}),m=function(r){return r.Uri="uri",r.Base64="base64",r.DataUrl="dataUrl",r}(m||{})},5346:(T,y,s)=>{s.d(y,{ez:()=>l,tP:()=>u});var u=function(i){return i.Documents="DOCUMENTS",i.Data="DATA",i.Library="LIBRARY",i.Cache="CACHE",i.External="EXTERNAL",i.ExternalStorage="EXTERNAL_STORAGE",i}(u||{}),l=function(i){return i.UTF8="utf8",i.ASCII="ascii",i.UTF16="utf16",i}(l||{})},6752:(T,y,s)=>{s.r(y),s.d(y,{AddImagesPage:()=>R});var u=s(5861),l=s(3614),m=s(2726),r=s(5346);const i=(0,m.fo)("Filesystem",{web:()=>s.e(4522).then(s.bind(s,4522)).then(e=>new e.FilesystemWeb)});var F=s(5961);const U=(0,m.fo)("Camera",{web:()=>s.e(6468).then(s.bind(s,6468)).then(e=>new e.CameraWeb)});var P=s(6814),Z=function(e){return e.Accessibility="accessibility",e.Account="account",e.AirplaneMode="airplane_mode",e.Apn="apn",e.ApplicationDetails="application_details",e.ApplicationDevelopment="application_development",e.Application="application",e.AppNotification="app_notification",e.BatteryOptimization="battery_optimization",e.Bluetooth="bluetooth",e.Captioning="captioning",e.Cast="cast",e.DataRoaming="data_roaming",e.Date="date",e.Display="display",e.Dream="dream",e.Home="home",e.Keyboard="keyboard",e.KeyboardSubType="keyboard_subtype",e.Locale="locale",e.Location="location",e.ManageApplications="manage_applications",e.ManageAllApplications="manage_all_applications",e.MemoryCard="memory_card",e.Network="network",e.NfcSharing="nfcsharing",e.NfcPayment="nfc_payment",e.NfcSettings="nfc_settings",e.Print="print",e.Privacy="privacy",e.QuickLaunch="quick_launch",e.Search="search",e.Security="security",e.Settings="settings",e.ShowRegulatoryInfo="show_regulatory_info",e.Sound="sound",e.Storage="storage",e.Sync="sync",e.Usage="usage",e.UserDictionary="user_dictionary",e.VoiceInput="voice_input",e.Wifi="wifi",e.WifiIp="wifi_ip",e.Wireless="wireless",e}(Z||{}),D=function(e){return e.About="about",e.App="app",e.AutoLock="autoLock",e.Bluetooth="bluetooth",e.DateTime="dateTime",e.FaceTime="facetime",e.General="general",e.Keyboard="keyboard",e.ICloud="iCloud",e.ICloudStorageBackup="iCloudStorageBackup",e.International="international",e.LocationServices="locationServices",e.Music="music",e.Notes="notes",e.Notifications="notifications",e.Phone="phone",e.Photos="photos",e.ManagedConfigurationList="managedConfigurationList",e.Reset="reset",e.Ringtone="ringtone",e.Sounds="sounds",e.SoftwareUpdate="softwareUpdate",e.Store="store",e.Tracking="tracking",e.Wallpaper="wallpaper",e.WiFi="wifi",e.Tethering="tethering",e.DoNotDisturb="doNotDisturb",e.TouchIdPasscode="touchIdPasscode",e}(D||{});const N=(0,m.fo)("NativeSettings",{web:()=>s.e(359).then(s.bind(s,359)).then(e=>new e.NativeSettingsWeb)});var I=s(7442),t=s(2029),$=s(9912),C=s(7626),k=s(1434);function L(e,g){1&e&&(t.TgZ(0,"h3",10),t._uU(1,"\u0627\u0644\u0631\u062c\u0627\u0621 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0635\u0648\u0631\u0629!"),t.qZA())}function A(e,g){if(1&e){const h=t.EpF();t.TgZ(0,"ion-item")(1,"ion-thumbnail",11),t._UZ(2,"ion-img",12),t.qZA(),t.TgZ(3,"ion-label",13),t._uU(4),t.qZA(),t.TgZ(5,"ion-button",14),t.NdJ("click",function(){const n=t.CHM(h).$implicit,c=t.oxw();return t.KtG(c.deleteImage(n))}),t._UZ(6,"ion-icon",15),t.qZA()()}if(2&e){const h=g.$implicit;t.xp6(2),t.Q6J("src",h.data),t.xp6(2),t.hij(" ",h.name," ")}}const v="stored-images";let R=(()=>{var e;class g{constructor(a,o,n,c,p){var d,f;this.supabase=o,this.router=n,this.plt=c,this.helper=p,this.modelId=1,this.type="request_status",this.convertBlobToBase64=E=>new Promise((x,B)=>{const b=new FileReader;b.onerror=B,b.onload=()=>{x(b.result)},b.readAsDataURL(E)}),this.pathImage=[],this.modelId=null===(d=a.snapshot.paramMap)||void 0===d?void 0:d.get("id"),this.type=null===(f=a.snapshot.paramMap)||void 0===f?void 0:f.get("type")}ngOnInit(){var a=this;return(0,u.Z)(function*(){yield a.loadFiles(),yield a.checkPermissions(),yield I.y.preload({assetId:"success",assetPath:"success.mp3",audioChannelNum:1,isUrl:!1})})()}checkPermissions(){return(0,u.Z)(function*(){const o=(yield i.checkPermissions()).publicStorage;"granted"!==o&&("denied"===o?(console.log("denied -> ask the user to change the access himself"),yield N.open({optionAndroid:Z.ApplicationDetails,optionIOS:D.App})):yield i.requestPermissions())})()}loadFiles(){var a=this;return(0,u.Z)(function*(){a.images=[],yield a.helper.startLoad(),i.readdir({path:`${v}-${a.type}-${a.modelId}`,directory:r.tP.Data}).then(o=>{a.loadFileData(o.files.map(n=>n.name))},function(){var o=(0,u.Z)(function*(n){yield i.mkdir({path:`${v}-${a.type}-${a.modelId}`,directory:r.tP.Data})});return function(n){return o.apply(this,arguments)}}()).then(o=>{a.helper.dismissLoader()})})()}loadFileData(a){var o=this;return(0,u.Z)(function*(){const n=`${v}-${o.type}-${o.modelId}`;for(let c of a){const p=`${n}/${c}`,d=yield i.readFile({path:p,directory:r.tP.Data});o.images.push({name:c,path:p,data:`data:image/jpeg;base64,${d.data}`})}})()}selectImage(){var a=this;return(0,u.Z)(function*(){const o=yield U.getPhoto({quality:90,allowEditing:!0,resultType:F.dk.Uri,source:F.oK.Prompt});o&&(yield a.saveImage(o))})()}saveImage(a){var o=this;return(0,u.Z)(function*(){const n=yield o.readAsBase64(a),c=(new Date).getTime()+".jpeg",p=`${v}-${o.type}-${o.modelId}`;yield i.writeFile({path:`${p}/${c}`,data:n,directory:r.tP.Data}),yield o.loadFiles()})()}readAsBase64(a){var o=this;return(0,u.Z)(function*(){if(o.plt.is("hybrid"))return(yield i.readFile({path:a.path})).data;{const c=yield(yield fetch(a.webPath)).blob();return yield o.convertBlobToBase64(c)}})()}startUpload(a){var o=this;return(0,u.Z)(function*(){const c=yield(yield fetch(a.data)).blob(),p=new FormData;p.append("image",c,a.name),yield o.uploadData(p)})()}uploadData(a){var o=this;return(0,u.Z)(function*(){a.append("request_id",o.modelId),a.append("type",o.type),o.supabase.saveFiles(o.type,o.modelId,a).then(n=>{var c;o.pathImage.push(null===(c=n.data)||void 0===c?void 0:c.path),o.helper.dismissLoader()}).catch(n=>{console.log(n)})})()}deleteImage(a){var o=this;return(0,u.Z)(function*(){yield o.loadFiles()})()}deleteImages(){var a=this;return(0,u.Z)(function*(){yield i.rmdir({directory:r.tP.Data,path:`${v}-${a.type}-${a.modelId}`,recursive:!0}),yield a.loadFiles(),a.successfulSound(),yield a.router.navigate(["/"])})()}uploadAllImage(){var a=this;return(0,u.Z)(function*(){yield a.helper.startLoad();for(let o of a.images){const c=yield(yield fetch(o.data)).blob(),p=new FormData;p.append("image",c,o.name),yield a.supabase.saveFiles(a.type,a.modelId,p).then(d=>{var f;a.pathImage.push(null===(f=d.data)||void 0===f?void 0:f.path)}).catch(d=>{console.error(d)})}yield a.supabase.updateData(a.type,a.modelId,{images:a.pathImage}).then(o=>204===o.status?(a.successfulSound(),a.router.navigate(["/"]),void a.helper.presentToast("\u062a\u0645 \u062a\u0642\u062f\u064a\u0645 \u0627\u0644\u0637\u0644\u0628 \u0628\u0646\u062c\u0627\u062d")):void a.helper.presentAlert("\u062e\u0637\u0627")).catch(o=>{console.log(o),a.helper.presentAlert(`err: ${o}`)}),yield a.helper.dismissLoader()})()}successfulSound(){I.y.play({assetId:"success"})}}return(e=g).\u0275fac=function(a){return new(a||e)(t.Y36($.gz),t.Y36(C.T),t.Y36($.F0),t.Y36(l.t4),t.Y36(k.W))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-add-images"]],standalone:!0,features:[t.jDz],decls:19,vars:3,consts:[[3,"fullscreen"],["class","ion-padding ion-text-center",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"m-ion-toolbar"],["color","m-ion-toolbar"],["fill","clear","expand","full","color","success",3,"click"],["slot","start","name","camera"],["fill","clear","expand","full","color","secondary",3,"click"],["slot","start","name","save"],["fill","clear","expand","full","color","danger",3,"click"],[1,"ion-padding","ion-text-center"],["slot","start"],[3,"src"],[1,"ion-text-wrap"],["slot","end","fill","clear",3,"click"],["slot","icon-only","name","trash"]],template:function(a,o){1&a&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"\u0631\u0641\u0639 \u0627\u0644\u0645\u0631\u0641\u0642\u0627\u062a"),t.qZA()()(),t.TgZ(4,"ion-content",0),t.YNc(5,L,2,0,"h3",1),t.TgZ(6,"ion-list"),t.YNc(7,A,7,2,"ion-item",2),t.qZA()(),t.TgZ(8,"ion-footer",3)(9,"ion-toolbar",4)(10,"ion-button",5),t.NdJ("click",function(){return o.selectImage()}),t._UZ(11,"ion-icon",6),t._uU(12," \u0627\u062e\u062a\u0627\u0631 \u0627\u0644\u0635\u0648\u0631\u0629 "),t.qZA(),t.TgZ(13,"ion-button",7),t.NdJ("click",function(){return o.uploadAllImage()}),t._UZ(14,"ion-icon",8),t._uU(15," \u062d\u0641\u0638 \u0627\u0644\u0635\u0648\u0631\u0629 "),t.qZA(),t.TgZ(16,"ion-button",9),t.NdJ("click",function(){return o.deleteImages()}),t._UZ(17,"ion-icon",6),t._uU(18," \u062d\u0641\u0638 \u0645\u0646 \u062f\u0648\u0646 \u0635\u0648\u0631 "),t.qZA()()()),2&a&&(t.xp6(4),t.Q6J("fullscreen",!0),t.xp6(1),t.Q6J("ngIf",0===o.images.length),t.xp6(2),t.Q6J("ngForOf",o.images))},dependencies:[l.Pc,l.YG,l.W2,l.fr,l.Gu,l.gu,l.Xz,l.Ie,l.Q$,l.q_,l.Bs,l.wd,l.sr,P.ez,P.sg,P.O5],styles:[".m-ion-toolbar[_ngcontent-%COMP%]{--background: #383a3e !important;border-radius:1.5%;background:#383a3e!important}"]}),g})()}}]);