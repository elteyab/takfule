"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5930],{5961:(N,O,u)=>{u.d(O,{GW:()=>h,dk:()=>D,oK:()=>d});var d=function(g){return g.Prompt="PROMPT",g.Camera="CAMERA",g.Photos="PHOTOS",g}(d||{}),h=function(g){return g.Rear="REAR",g.Front="FRONT",g}(h||{}),D=function(g){return g.Uri="uri",g.Base64="base64",g.DataUrl="dataUrl",g}(D||{})},2726:(N,O,u)=>{u.d(O,{Sd:()=>E,Uw:()=>w,fo:()=>J,xz:()=>r});var d=u(5861);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var U=function(o){return o.Unimplemented="UNIMPLEMENTED",o.Unavailable="UNAVAILABLE",o}(U||{});class r extends Error{constructor(e,t,a){super(e),this.message=e,this.code=t,this.data=a}}const X=o=>{var e,t,a,c,s;const m=o.CapacitorCustomPlatform||null,l=o.Capacitor||{},A=l.Plugins=l.Plugins||{},p=o.CapacitorPlatforms,S=(null===(e=null==p?void 0:p.currentPlatform)||void 0===e?void 0:e.getPlatform)||(()=>null!==m?m.name:(o=>{var e,t;return null!=o&&o.androidBridge?"android":null!==(t=null===(e=null==o?void 0:o.webkit)||void 0===e?void 0:e.messageHandlers)&&void 0!==t&&t.bridge?"ios":"web"})(o)),ce=(null===(t=null==p?void 0:p.currentPlatform)||void 0===t?void 0:t.isNativePlatform)||(()=>"web"!==S()),fe=(null===(a=null==p?void 0:p.currentPlatform)||void 0===a?void 0:a.isPluginAvailable)||(P=>{const b=te.get(P);return!!(null!=b&&b.platforms.has(S())||ae(P))}),ae=(null===(c=null==p?void 0:p.currentPlatform)||void 0===c?void 0:c.getPluginHeader)||(P=>{var b;return null===(b=l.PluginHeaders)||void 0===b?void 0:b.find(H=>H.name===P)}),te=new Map,ve=(null===(s=null==p?void 0:p.currentPlatform)||void 0===s?void 0:s.registerPlugin)||((P,b={})=>{const H=te.get(P);if(H)return console.warn(`Capacitor plugin "${P}" already registered. Cannot register plugins twice.`),H.proxy;const R=S(),G=ae(P);let F;const ye=function(){var C=(0,d.Z)(function*(){return!F&&R in b?F=F="function"==typeof b[R]?yield b[R]():b[R]:null!==m&&!F&&"web"in b&&(F=F="function"==typeof b.web?yield b.web():b.web),F});return function(){return C.apply(this,arguments)}}(),ne=C=>{let I;const T=(...x)=>{const k=ye().then(L=>{const W=((C,I)=>{var T,x;if(!G){if(C)return null===(x=C[I])||void 0===x?void 0:x.bind(C);throw new r(`"${P}" plugin is not implemented on ${R}`,U.Unimplemented)}{const k=null==G?void 0:G.methods.find(L=>I===L.name);if(k)return"promise"===k.rtype?L=>l.nativePromise(P,I.toString(),L):(L,W)=>l.nativeCallback(P,I.toString(),L,W);if(C)return null===(T=C[I])||void 0===T?void 0:T.bind(C)}})(L,C);if(W){const Y=W(...x);return I=null==Y?void 0:Y.remove,Y}throw new r(`"${P}.${C}()" is not implemented on ${R}`,U.Unimplemented)});return"addListener"===C&&(k.remove=(0,d.Z)(function*(){return I()})),k};return T.toString=()=>`${C.toString()}() { [capacitor code] }`,Object.defineProperty(T,"name",{value:C,writable:!1,configurable:!1}),T},le=ne("addListener"),de=ne("removeListener"),be=(C,I)=>{const T=le({eventName:C},I),x=function(){var L=(0,d.Z)(function*(){const W=yield T;de({eventName:C,callbackId:W},I)});return function(){return L.apply(this,arguments)}}(),k=new Promise(L=>T.then(()=>L({remove:x})));return k.remove=(0,d.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield x()}),k},re=new Proxy({},{get(C,I){switch(I){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return G?be:le;case"removeListener":return de;default:return ne(I)}}});return A[P]=re,te.set(P,{name:P,proxy:re,platforms:new Set([...Object.keys(b),...G?[R]:[]])}),re});return l.convertFileSrc||(l.convertFileSrc=P=>P),l.getPlatform=S,l.handleError=P=>o.console.error(P),l.isNativePlatform=ce,l.isPluginAvailable=fe,l.pluginMethodNoop=(P,b,H)=>Promise.reject(`${H} does not have an implementation of "${b}".`),l.registerPlugin=ve,l.Exception=r,l.DEBUG=!!l.DEBUG,l.isLoggingEnabled=!!l.isLoggingEnabled,l.platform=l.getPlatform(),l.isNative=l.isNativePlatform(),l},j=(o=>o.Capacitor=X(o))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),J=j.registerPlugin;class w{constructor(e){this.listeners={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){var a=this;this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);const s=this.windowListeners[e];s&&!s.registered&&this.addWindowListener(s);const m=function(){var A=(0,d.Z)(function*(){return a.removeListener(e,t)});return function(){return A.apply(this,arguments)}}(),l=Promise.resolve({remove:m});return Object.defineProperty(l,"remove",{value:(A=(0,d.Z)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield m()}),function(){return A.apply(this,arguments)})}),l;var A}removeAllListeners(){var e=this;return(0,d.Z)(function*(){e.listeners={};for(const t in e.windowListeners)e.removeWindowListener(e.windowListeners[t]);e.windowListeners={}})()}notifyListeners(e,t){const a=this.listeners[e];a&&a.forEach(c=>c(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:a=>{this.notifyListeners(t,a)}}}unimplemented(e="not implemented"){return new j.Exception(e,U.Unimplemented)}unavailable(e="not available"){return new j.Exception(e,U.Unavailable)}removeListener(e,t){var a=this;return(0,d.Z)(function*(){const c=a.listeners[e];if(!c)return;const s=c.indexOf(t);a.listeners[e].splice(s,1),a.listeners[e].length||a.removeWindowListener(a.windowListeners[e])})()}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const _=o=>encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),n=o=>o.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class i extends w{getCookies(){return(0,d.Z)(function*(){const e=document.cookie,t={};return e.split(";").forEach(a=>{if(a.length<=0)return;let[c,s]=a.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");c=n(c).trim(),s=n(s).trim(),t[c]=s}),t})()}setCookie(e){return(0,d.Z)(function*(){try{const t=_(e.key),a=_(e.value),c=`; expires=${(e.expires||"").replace("expires=","")}`,s=(e.path||"/").replace("path=",""),m=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${a||""}${c}; path=${s}; ${m};`}catch(t){return Promise.reject(t)}})()}deleteCookie(e){return(0,d.Z)(function*(){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}})()}clearCookies(){return(0,d.Z)(function*(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}})()}clearAllCookies(){var e=this;return(0,d.Z)(function*(){try{yield e.clearCookies()}catch(t){return Promise.reject(t)}})()}}J("CapacitorCookies",{web:()=>new i});const y=function(){var o=(0,d.Z)(function*(e){return new Promise((t,a)=>{const c=new FileReader;c.onload=()=>{const s=c.result;t(s.indexOf(",")>=0?s.split(",")[1]:s)},c.onerror=s=>a(s),c.readAsDataURL(e)})});return function(t){return o.apply(this,arguments)}}(),E=(o,e={})=>{const t=Object.assign({method:o.method||"GET",headers:o.headers},e),c=((o={})=>{const e=Object.keys(o);return Object.keys(o).map(c=>c.toLocaleLowerCase()).reduce((c,s,m)=>(c[s]=o[e[m]],c),{})})(o.headers)["content-type"]||"";if("string"==typeof o.data)t.body=o.data;else if(c.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[m,l]of Object.entries(o.data||{}))s.set(m,l);t.body=s.toString()}else if(c.includes("multipart/form-data")){const s=new FormData;if(o.data instanceof FormData)o.data.forEach((l,A)=>{s.append(A,l)});else for(const l of Object.keys(o.data))s.append(l,o.data[l]);t.body=s;const m=new Headers(t.headers);m.delete("content-type"),t.headers=m}else(c.includes("application/json")||"object"==typeof o.data)&&(t.body=JSON.stringify(o.data));return t};class q extends w{request(e){return(0,d.Z)(function*(){const t=E(e,e.webFetchExtra),a=((o,e=!0)=>o?Object.entries(o).reduce((a,c)=>{const[s,m]=c;let l,A;return Array.isArray(m)?(A="",m.forEach(p=>{l=e?encodeURIComponent(p):p,A+=`${s}=${l}&`}),A.slice(0,-1)):(l=e?encodeURIComponent(m):m,A=`${s}=${l}`),`${a}&${A}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),c=a?`${e.url}?${a}`:e.url,s=yield fetch(c,t),m=s.headers.get("content-type")||"";let A,p,{responseType:l="text"}=s.ok?e:{};switch(m.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":p=yield s.blob(),A=yield y(p);break;case"json":A=yield s.json();break;default:A=yield s.text()}const z={};return s.headers.forEach((S,ee)=>{z[ee]=S}),{data:A,headers:z,status:s.status,url:s.url}})()}get(e){var t=this;return(0,d.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"GET"}))})()}post(e){var t=this;return(0,d.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"POST"}))})()}put(e){var t=this;return(0,d.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"PUT"}))})()}patch(e){var t=this;return(0,d.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"PATCH"}))})()}delete(e){var t=this;return(0,d.Z)(function*(){return t.request(Object.assign(Object.assign({},e),{method:"DELETE"}))})()}}J("CapacitorHttp",{web:()=>new q})},5346:(N,O,u)=>{u.d(O,{ez:()=>h,tP:()=>d});var d=function(v){return v.Documents="DOCUMENTS",v.Data="DATA",v.Library="LIBRARY",v.Cache="CACHE",v.External="EXTERNAL",v.ExternalStorage="EXTERNAL_STORAGE",v}(d||{}),h=function(v){return v.UTF8="utf8",v.ASCII="ascii",v.UTF16="utf16",v}(h||{})},5930:(N,O,u)=>{u.r(O),u.d(O,{AddImagesPage:()=>ie});var d=u(5861),h=u(1509),D=u(2726),g=u(5346);const v=(0,D.fo)("Filesystem",{web:()=>u.e(4522).then(u.bind(u,4522)).then(w=>new w.FilesystemWeb)});var Q=u(5961);const V=(0,D.fo)("Camera",{web:()=>u.e(6468).then(u.bind(u,6468)).then(w=>new w.CameraWeb)});var U=u(6814),r=u(6689),K=u(6958),X=u(7626),oe=u(1434);function j(w,B){1&w&&(r.TgZ(0,"h3",11),r._uU(1,"\u0627\u0644\u0631\u062c\u0627\u0621 \u062a\u062d\u062f\u064a\u062f \u0627\u0644\u0635\u0648\u0631\u0629!"),r.qZA())}function J(w,B){if(1&w){const _=r.EpF();r.TgZ(0,"ion-item")(1,"ion-thumbnail",12),r._UZ(2,"ion-img",13),r.qZA(),r.TgZ(3,"ion-label",14),r._uU(4),r.qZA(),r.TgZ(5,"ion-button",15),r.NdJ("click",function(){const f=r.CHM(_).$implicit,y=r.oxw();return r.KtG(y.deleteImage(f))}),r._UZ(6,"ion-icon",16),r.qZA()()}if(2&w){const _=B.$implicit;r.xp6(2),r.Q6J("src",_.data),r.xp6(2),r.hij(" ",_.name," ")}}const M="stored-images";let ie=(()=>{var w;class B{constructor(n,i,f,y,$){var Z,E;this.supabase=i,this.router=f,this.plt=y,this.helper=$,this.modelId=1,this.type="request_status",this.convertBlobToBase64=q=>new Promise((se,o)=>{const e=new FileReader;e.onerror=o,e.onload=()=>{se(e.result)},e.readAsDataURL(q)}),this.pathImage=[],this.modelId=null===(Z=n.snapshot.paramMap)||void 0===Z?void 0:Z.get("id"),this.type=null===(E=n.snapshot.paramMap)||void 0===E?void 0:E.get("type")}ngOnInit(){var n=this;return(0,d.Z)(function*(){console.log("mo: ",n.modelId,"ty: ",n.type),yield n.loadFiles()})()}loadFiles(){var n=this;return(0,d.Z)(function*(){n.images=[],yield n.helper.startLoad(),v.readdir({path:`${M}-${n.type}-${n.modelId}`,directory:g.tP.Data}).then(i=>{n.loadFileData(i.files.map(f=>f.name))},function(){var i=(0,d.Z)(function*(f){yield v.mkdir({path:`${M}-${n.type}-${n.modelId}`,directory:g.tP.Data})});return function(f){return i.apply(this,arguments)}}()).then(i=>{n.helper.dismissLoader()})})()}loadFileData(n){var i=this;return(0,d.Z)(function*(){const f=`${M}-${i.type}-${i.modelId}`;for(let y of n){const $=`${f}/${y}`,Z=yield v.readFile({path:$,directory:g.tP.Data});i.images.push({name:y,path:$,data:`data:image/jpeg;base64,${Z.data}`})}})()}selectImage(){var n=this;return(0,d.Z)(function*(){const i=yield V.getPhoto({quality:90,allowEditing:!1,resultType:Q.dk.Uri,source:Q.oK.Photos});i&&(yield n.saveImage(i))})()}saveImage(n){var i=this;return(0,d.Z)(function*(){const f=yield i.readAsBase64(n),y=(new Date).getTime()+".jpeg",$=`${M}-${i.type}-${i.modelId}`;yield v.writeFile({path:`${$}/${y}`,data:f,directory:g.tP.Data}),yield i.loadFiles()})()}readAsBase64(n){var i=this;return(0,d.Z)(function*(){if(i.plt.is("hybrid"))return(yield v.readFile({path:n.path})).data;{const y=yield(yield fetch(n.webPath)).blob();return yield i.convertBlobToBase64(y)}})()}startUpload(n){var i=this;return(0,d.Z)(function*(){const y=yield(yield fetch(n.data)).blob(),$=new FormData;$.append("image",y,n.name),yield i.uploadData($)})()}uploadData(n){var i=this;return(0,d.Z)(function*(){n.append("request_id",i.modelId),n.append("type",i.type),i.supabase.saveFiles(i.type,i.modelId,n).then(f=>{var y;console.log("res",f),i.pathImage.push(null===(y=f.data)||void 0===y?void 0:y.path),console.log("aa: ",i.pathImage),i.helper.dismissLoader()}).catch(f=>{console.log(f)})})()}deleteImage(n){var i=this;return(0,d.Z)(function*(){yield i.loadFiles()})()}deleteImages(){var n=this;return(0,d.Z)(function*(){yield v.rmdir({directory:g.tP.Data,path:`${M}-${n.type}-${n.modelId}`,recursive:!0}),yield n.loadFiles(),yield n.router.navigate(["/"])})()}uploadAllImage(){var n=this;return(0,d.Z)(function*(){yield n.helper.startLoad();for(let i of n.images){const y=yield(yield fetch(i.data)).blob(),$=new FormData;$.append("image",y,i.name),yield n.supabase.saveFiles(n.type,n.modelId,$).then(Z=>{var E;console.log("res",Z),n.pathImage.push(null===(E=Z.data)||void 0===E?void 0:E.path)}).catch(Z=>{console.error(Z)})}console.log(n.pathImage),yield n.supabase.updateData(n.type,n.modelId,{images:n.pathImage}).then(i=>(console.log("resp: ",i),204===i.status?(n.router.navigate(["/"]),void n.helper.presentToast("\u062a\u0645 \u062a\u0642\u062f\u064a\u0645 \u0627\u0644\u0637\u0644\u0628 \u0628\u0646\u062c\u0627\u062d")):void n.helper.presentAlert("\u062e\u0637\u0627"))).catch(i=>{console.log(i),n.helper.presentAlert(`err: ${i}`)}),yield n.helper.dismissLoader()})()}}return(w=B).\u0275fac=function(n){return new(n||w)(r.Y36(K.gz),r.Y36(X.T),r.Y36(K.F0),r.Y36(h.t4),r.Y36(oe.W))},w.\u0275cmp=r.Xpm({type:w,selectors:[["app-add-images"]],standalone:!0,features:[r.jDz],decls:19,vars:3,consts:[["color","primary"],[1,"ion-text-center"],[3,"fullscreen"],["class","ion-padding ion-text-center",4,"ngIf"],[4,"ngFor","ngForOf"],[2,"background-color","#f4f5f8"],["fill","clear","expand","full","color","primary",3,"click"],["slot","start","name","camera"],["fill","clear","expand","full","color","secondary",3,"click"],["slot","start","name","save"],["fill","clear","expand","full","color","danger",3,"click"],[1,"ion-padding","ion-text-center"],["slot","start"],[3,"src"],[1,"ion-text-wrap"],["slot","end","fill","clear",3,"click"],["slot","icon-only","name","trash"]],template:function(n,i){1&n&&(r.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title",1),r._uU(3,"\u0631\u0641\u0639 \u0627\u0644\u0645\u0631\u0641\u0642\u0627\u062a"),r.qZA()()(),r.TgZ(4,"ion-content",2),r.YNc(5,j,2,0,"h3",3),r.TgZ(6,"ion-list"),r.YNc(7,J,7,2,"ion-item",4),r.qZA()(),r.TgZ(8,"ion-footer")(9,"ion-toolbar",5)(10,"ion-button",6),r.NdJ("click",function(){return i.selectImage()}),r._UZ(11,"ion-icon",7),r._uU(12," \u0627\u062e\u062a\u0627\u0631 \u0627\u0644\u0635\u0648\u0631\u0629 "),r.qZA(),r.TgZ(13,"ion-button",8),r.NdJ("click",function(){return i.uploadAllImage()}),r._UZ(14,"ion-icon",9),r._uU(15," \u062d\u0641\u0638 \u0627\u0644\u0635\u0648\u0631\u0629 "),r.qZA(),r.TgZ(16,"ion-button",10),r.NdJ("click",function(){return i.deleteImages()}),r._UZ(17,"ion-icon",7),r._uU(18," \u062d\u0641\u0638 \u0645\u0646 \u062f\u0648\u0646 \u0635\u0648\u0631 "),r.qZA()()()),2&n&&(r.xp6(4),r.Q6J("fullscreen",!0),r.xp6(1),r.Q6J("ngIf",0===i.images.length),r.xp6(2),r.Q6J("ngForOf",i.images))},dependencies:[h.Pc,h.YG,h.W2,h.fr,h.Gu,h.gu,h.Xz,h.Ie,h.Q$,h.q_,h.Bs,h.wd,h.sr,U.ez,U.sg,U.O5]}),B})()}}]);